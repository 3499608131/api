<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title> </title>
    <style>
        html,body {margin:0;padding:0;height:100%;width:100%;background:#f8faff;}
        body {height:100vh;width:100vw;}
        #contentFrame {width:100vw;height:100vh;border:none;}
        .err-tip {color:#d32f2f;text-align:center;margin-top:40px;font-size:1.2em;}
        .notice-tip {
            color:#1976d2;
            text-align:center;
            margin-top:30px;
            font-size:1.08em;
            background:#e3f2fd;
            padding: 14px 14px 11px 14px;
            border-radius: 12px;
            margin-left: 8vw;
            margin-right: 8vw;
            line-height: 1.7;
        }
    </style>
    <script>
        // 独家编码字符表（与主站完全一致）
        const customTable = 'QWErtyuioPASDFGHJKLZXCVBNM1234567890qweRTYUIOpasdfghjklzxcvbnm-_';

        // 检查是否为独家编码
        function isMyCode(str) {
            if (!str) return false;
            for (let i = 0; i < str.length; i++) {
                if (!customTable.includes(str[i])) return false;
            }
            return true;
        }

        // 新版独家解码（反转扰乱+utf8还原+短参数自动提取原始链接）
        function decodeX(str) {
            let bin = '';
            for (let i = 0; i < str.length; i++) {
                let idx = customTable.indexOf(str[i]);
                if (idx === -1) continue;
                bin += idx.toString(2).padStart(6, '0');
            }
            // 反扰乱（全反转）
            let arr = bin.split('');
            for (let i = 0; i < arr.length; i++) {
                arr[i] = arr[i] === '1' ? '0' : '1';
            }
            let obf = arr.join('');
            // 8位一组还原utf8
            let out = '';
            for (let i = 0; i + 8 <= obf.length; i += 8) {
                out += String.fromCharCode(parseInt(obf.substr(i, 8), 2));
            }
            // 取原始链接部分（前10位为时间戳+随机，剩下为url）
            if (out.length > 12) {
                return out.substring(10); // 跳过前10位
            } else {
                return '';
            }
        }

        function getQueryParam(param) {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function showError(msg) {
            document.body.innerHTML = '<div class="err-tip">'+msg+'</div>';
        }

        function showNotice(msg) {
            document.body.innerHTML = '<div class="notice-tip">'+msg+'</div>';
        }

        window.onload = function() {
            var code = getQueryParam('u');
            if (!isMyCode(code)) {
                showError("如果您是用户，请联系管理员为您添加白名单并正确的防红生成系统访问本页面");
                return;
            }
            var targetUrl = '';
            try {
                targetUrl = decodeX(code);
            } catch (e) {
                showError("独家编码参数解码失败，请检查链接是否正确。");
                return;
            }
            if (!/^https?:\/\//i.test(targetUrl)) {
                showError("目标链接格式不正确，只允许以 http:// 或 https:// 开头的链接。");
                return;
            }
            // 防止死循环嵌套（防止目标页也是本页面自身）
            var currUrl = window.location.href.replace(/\?.*$/, '').toLowerCase();
            var targetPlain = targetUrl.replace(/\?.*$/, '').toLowerCase();
            if (currUrl === targetPlain) {
                showError("目标链接禁止为本页面自身，防止死循环。");
                return;
            }
            // 防止被嵌套在其它页面iframe里
            if (window.top !== window.self) {
                window.top.location = window.location.href;
                return;
            }
            // 加载目标链接
            document.getElementById('contentFrame').src = targetUrl;
        };
    </script>
</head>
<body>
    <iframe id="contentFrame"></iframe>
</body>
</html>